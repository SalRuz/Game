<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Agar.io Clone</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
            touch-action: none;
            font-family: Arial, sans-serif;
        }
        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
            transform: rotate(0deg);
        }
        #joystick {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 80px;
            height: 80px;
            pointer-events: auto;
            z-index: 10;
        }
        #joystick-base {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(200, 200, 200, 0.5);
            border-radius: 50%;
            display: none;
        }
        #joystick-thumb {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(100, 100, 100, 0.7);
            border-radius: 50%;
            left: 20px;
            top: 20px;
            display: none;
        }
        #gameOverMenu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 36px;
            z-index: 20;
        }
        #restartButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #leaderboard {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.7);
            padding: 8px;
            border-radius: 5px;
            min-width: 120px;
            font-size: 12px;
            z-index: 15;
            max-height: 120px;
            overflow-y: auto;
        }
        .player-entry {
            margin: 3px 0;
            font-size: 11px;
        }
        .player-entry.player {
            color: red;
            font-weight: bold;
            padding: 1px;
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="joystick">
        <div id="joystick-base"></div>
        <div id="joystick-thumb"></div>
    </div>
    <div id="leaderboard"></div>
    <div id="gameOverMenu">
        <div>Game Over!</div>
        <button id="restartButton">Restart</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const leaderboard = document.getElementById('leaderboard');
        const gameOverMenu = document.getElementById('gameOverMenu');
        const restartButton = document.getElementById('restartButton');
        const joystickBase = document.getElementById('joystick-base');
        const joystickThumb = document.getElementById('joystick-thumb');

        // Настройки игры
        const settings = {
            playerStartSize: 5,
            foodSize: 1,
            botCount: 10,
            mapScale: 5,
            foodCount: 200,
        };

        // Игрок
        let player = {
            x: 0,
            y: 0,
            size: settings.playerStartSize,
            color: getRandomColor(),
            speed: 5,
            direction: { x: 0, y: 0 },
        };

        // Еда
        let foods = [];
        // Боты
        let bots = [];
        // Топ игроков
        let topPlayers = [];

        // Инициализация
        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            player.x = canvas.width / 2;
            player.y = canvas.height / 2;

            foods = [];
            for (let i = 0; i < settings.foodCount; i++) {
                foods.push({
                    x: Math.random() * canvas.width * settings.mapScale,
                    y: Math.random() * canvas.height * settings.mapScale,
                    size: settings.foodSize,
                    color: '#66ff33',
                });
            }

            bots = [];
            for (let i = 0; i < settings.botCount; i++) {
                bots.push({
                    x: Math.random() * canvas.width * settings.mapScale,
                    y: Math.random() * canvas.height * settings.mapScale,
                    size: settings.playerStartSize,
                    color: getRandomColor(),
                    speed: 2 + Math.random() * 2,
                    direction: { x: Math.random() * 2 - 1, y: Math.random() * 2 - 1 },
                });
            }

            gameOverMenu.style.display = 'none';
            gameLoop();
        }

        // Основной цикл игры
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // Обновление состояния
        function update() {
            // Движение игрока
            const speed = player.speed / player.size;
            player.x += player.direction.x * speed;
            player.y += player.direction.y * speed;

            // Проверка границ
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width * settings.mapScale) player.x = canvas.width * settings.mapScale;
            if (player.y < 0) player.y = 0;
            if (player.y > canvas.height * settings.mapScale) player.y = canvas.height * settings.mapScale;

            // Движение ботов
            bots.forEach(bot => {
                bot.x += bot.direction.x * (bot.speed / bot.size);
                bot.y += bot.direction.y * (bot.speed / bot.size);

                if (bot.x < 0 || bot.x > canvas.width * settings.mapScale) bot.direction.x *= -1;
                if (bot.y < 0 || bot.y > canvas.height * settings.mapScale) bot.direction.y *= -1;
            });

            // Проверка столкновений с едой
            foods = foods.filter(food => {
                const dx = player.x - food.x;
                const dy = player.y - food.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < player.size) {
                    player.size += food.size;
                    return false;
                }
                return true;
            });

            // Проверка столкновений с ботами
            bots = bots.filter(bot => {
                const dx = player.x - bot.x;
                const dy = player.y - bot.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < player.size && player.size > bot.size) {
                    player.size += bot.size;
                    return false;
                }
                return true;
            });

            // Проверка столкновений ботов с едой
            foods = foods.filter(food => {
                let eaten = false;
                bots.forEach(bot => {
                    const dx = bot.x - food.x;
                    const dy = bot.y - food.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < bot.size) {
                        bot.size += food.size;
                        eaten = true;
                    }
                });
                return !eaten;
            });

            // Проверка столкновений ботов между собой
            bots = bots.filter(bot => {
                let eaten = false;
                bots.forEach(otherBot => {
                    if (bot === otherBot) return;
                    const dx = bot.x - otherBot.x;
                    const dy = bot.y - otherBot.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < otherBot.size && otherBot.size > bot.size) {
                        otherBot.size += bot.size;
                        eaten = true;
                    }
                });
                return !eaten;
            });

            // Обновление топ-листа
            updateLeaderboard();
        }

        // Отрисовка
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Отрисовка фона
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Отрисовка еды
            foods.forEach(food => {
                const screenX = food.x / settings.mapScale;
                const screenY = food.y / settings.mapScale;
                const screenSize = food.size / settings.mapScale;
                ctx.fillStyle = food.color;
                ctx.beginPath();
                ctx.arc(screenX, screenY, screenSize, 0, Math.PI * 2);
                ctx.fill();
            });

            // Отрисовка ботов
            bots.forEach(bot => {
                const screenX = bot.x / settings.mapScale;
                const screenY = bot.y / settings.mapScale;
                const screenSize = bot.size / settings.mapScale;
                ctx.fillStyle = bot.color;
                ctx.beginPath();
                ctx.arc(screenX, screenY, screenSize, 0, Math.PI * 2);
                ctx.fill();
            });

            // Отрисовка игрока
            const playerScreenX = player.x / settings.mapScale;
            const playerScreenY = player.y / settings.mapScale;
            const playerScreenSize = player.size / settings.mapScale;
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(playerScreenX, playerScreenY, playerScreenSize, 0, Math.PI * 2);
            ctx.fill();
        }

        // Обновление топ-листа
        function updateLeaderboard() {
            const allPlayers = [...bots, player];
            allPlayers.sort((a, b) => b.size - a.size);
            topPlayers = allPlayers.slice(0, 5);

            leaderboard.innerHTML = '';
            topPlayers.forEach((p, index) => {
                const entry = document.createElement('div');
                entry.className = 'player-entry';
                if (p === player) entry.classList.add('player');
                entry.textContent = `${index + 1}. ${p === player ? 'You' : 'Bot'} (${Math.round(p.size)})`;
                leaderboard.appendChild(entry);
            });
        }

        // Случайный цвет
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Управление
        let touchStart = null;
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            joystickBase.style.display = 'block';
            joystickThumb.style.display = 'block';
            joystickBase.style.left = `${touchStart.x - 40}px`;
            joystickBase.style.top = `${touchStart.y - 40}px`;
            joystickThumb.style.left = `${touchStart.x - 20}px`;
            joystickThumb.style.top = `${touchStart.y - 20}px`;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!touchStart) return;
            const touch = e.touches[0];
            const dx = touch.clientX - touchStart.x;
            const dy = touch.clientY - touchStart.y;
            const distance = Math.min(Math.sqrt(dx * dx + dy * dy), 40);
            const angle = Math.atan2(dy, dx);
            const thumbX = touchStart.x + Math.cos(angle) * distance;
            const thumbY = touchStart.y + Math.sin(angle) * distance;

            joystickThumb.style.left = `${thumbX - 20}px`;
            joystickThumb.style.top = `${thumbY - 20}px`;

            player.direction = { x: dx / 50, y: dy / 50 };
        });

        canvas.addEventListener('touchend', () => {
            touchStart = null;
            joystickBase.style.display = 'none';
            joystickThumb.style.display = 'none';
            player.direction = { x: 0, y: 0 };
        });

        // Кнопка рестарта
        restartButton.addEventListener('click', init);

        // Запуск игры
        window.addEventListener('load', init);
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
